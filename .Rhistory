"+proj=mill +lat_0=0 +lon_0=0 +x_0=0 +y_0=0 +R_A +datum=WGS84 +units=m +no_defs")
shape_json <- geojsonio::geojson_json(shape_transform)
highchart(type = "map") |>
hc_chart( map= "topology",
spacingBottom= 20) |>
hc_add_series(
mapData = shape_json,
data = d,
joinBy = "..gd_id"
)
data <- data |> dplyr::filter(annoh == "2022",
variable == "Consolidado de riesgo",
circ == "Nacionales") |>
dplyr::select(Municipio, value = riesgo, codmpio)
data <- read.csv("BD mapa de riesgo - Sheet1.csv")
data <- data |> dplyr::filter(annoh == "2022",
variable == "Consolidado de riesgo",
circ == "Nacionales") |>
dplyr::select(Municipio, value = riesgo, codmpio)
d <- geodato::gd_match(data, map_name)
dgeo <- tj |> left_join(d, by = c(id = "..gd_id", name = "..gd_name"))
dgeo <- dgeo %>% sf::st_set_crs(3857)
shape_transform <- sf::st_transform(dgeo,
"+proj=mill +lat_0=0 +lon_0=0 +x_0=0 +y_0=0 +R_A +datum=WGS84 +units=m +no_defs")
shape_json <- geojsonio::geojson_json(shape_transform)
highchart(type = "map") |>
hc_chart( map= "topology",
spacingBottom= 20) |>
hc_add_series(
mapData = shape_json,
data = d,
joinBy = "..gd_id"
)
data <- read.csv("BD mapa de riesgo - Sheet1.csv")
data <- data |> dplyr::filter(annoh == "2022",
variable == "Consolidado de riesgo",
circ == "Nacionales") |>
dplyr::select(Municipio, riesgo, codmpio)
unique(data$riesgo)
data$value <- recode("Sin riesgo" = 0)
data$value <- recode(  0 = "Sin riesgo")
?recode
data$value <- recode(data$riesgo, c("Sin riesgo" = 0))
recode(data$riesgo, c("Sin riesgo" = 0))
recode(data$riesgo, "Sin riesgo" = 0)
unique(data$riesgo)
data$value <- recode(data$riesgo,
"Sin riesgo" = 0,
"Medio (por alto nivel de la variable)" = 1,
"Alto (por alto nivel de la variable)" = 2,
"Extremo (por alto nivel de la variable)" = 3)
library(dplyr)
map_name <- "col_municipalities"
tj <- geodato::gd_tj(map_name)
data <- read.csv("BD mapa de riesgo - Sheet1.csv")
data <- data |> dplyr::filter(annoh == "2022",
variable == "Consolidado de riesgo",
circ == "Nacionales") |>
dplyr::select(Municipio, riesgo, codmpio)
data$value <- recode(data$riesgo,
"Sin riesgo" = 0,
"Medio (por alto nivel de la variable)" = 1,
"Alto (por alto nivel de la variable)" = 2,
"Extremo (por alto nivel de la variable)" = 3)
d <- geodato::gd_match(data, map_name)
dgeo <- tj |> left_join(d, by = c(id = "..gd_id", name = "..gd_name"))
dgeo <- dgeo %>% sf::st_set_crs(3857)
shape_transform <- sf::st_transform(dgeo,
"+proj=mill +lat_0=0 +lon_0=0 +x_0=0 +y_0=0 +R_A +datum=WGS84 +units=m +no_defs")
shape_json <- geojsonio::geojson_json(shape_transform)
highchart(type = "map") |>
hc_chart( map= "topology",
spacingBottom= 20) |>
hc_add_series(
mapData = shape_json,
data = d,
joinBy = "..gd_id"
)
highchart(type = "map") |>
hc_add_series(
mapData = shape_json,
data = d,
joinBy = "..gd_id"
)
shape_json
highchart(type = "map") |>
hc_add_series(
mapData = shape_json,
data = d,
joinBy = "..gd_name"
)
data$value
dgeo
highchart(type = "map") |>
hc_add_series(
mapData = shape_json,
data = dgeo,
joinBy = "..gd_name"
)
highchart(type = "map") |>
hc_add_series(
mapData = shape_json,
data = dgeo,
joinBy = "name"
)
map_name <- "col_municipalities"
tj <- geodato::gd_tj(map_name)
data <- read.csv("BD mapa de riesgo - Sheet1.csv")
data <- data |> dplyr::filter(annoh == "2022",
variable == "Consolidado de riesgo",
circ == "Nacionales") |>
dplyr::select(Municipio, riesgo, codmpio)
d <- geodato::gd_match(data, map_name)
dgeo <- tj |> left_join(d, by = c(id = "..gd_id", name = "..gd_name"))
dgeo <- dgeo %>% sf::st_set_crs(3857)
shape_transform <- sf::st_transform(dgeo,
"+proj=mill +lat_0=0 +lon_0=0 +x_0=0 +y_0=0 +R_A +datum=WGS84 +units=m +no_defs")
shape_json <- geojsonio::geojson_json(shape_transform)
highchart(type = "map") |>
hc_chart( map= "topology",
spacingBottom= 20) |>
hc_add_series(
mapData = shape_json,
data = dgeo,
joinBy = "name"
)
data <- read.csv("BD mapa de riesgo - Sheet1.csv")
data <- data |> dplyr::filter(annoh == "2022",
variable == "Consolidado de riesgo",
circ == "Nacionales") |>
dplyr::select(Municipio, value = riesgo, codmpio)
d <- geodato::gd_match(data, map_name)
dgeo <- tj |> left_join(d, by = c(id = "..gd_id", name = "..gd_name"))
dgeo <- dgeo %>% sf::st_set_crs(3857)
shape_transform <- sf::st_transform(dgeo,
"+proj=mill +lat_0=0 +lon_0=0 +x_0=0 +y_0=0 +R_A +datum=WGS84 +units=m +no_defs")
shape_json <- geojsonio::geojson_json(shape_transform)
highchart(type = "map") |>
hc_chart( map= "topology",
spacingBottom= 20) |>
hc_add_series(
mapData = shape_json,
data = d,
joinBy = "name"
)
highchart(type = "map") |>
hc_chart( map= "topology",
spacingBottom= 20) |>
hc_add_series(
mapData = shape_json,
data = dgeo,
joinBy = "name"
)
highchart(type = "map") |>
hc_chart( map= "topology",
spacingBottom= 20) |>
hc_plotOptions(
map = list(
allAreas= FALSE
)
) |>
hc_add_series(
mapData = shape_json,
data = dgeo,
joinBy = "name"
)
highchart(type = "map") |>
hc_chart( map= "topology",
spacingBottom= 20) |>
hc_add_series(
mapData = shape_json,
data = dgeo,
joinBy = "name"
) |>
hc_colors(
stops = color_stops(colors = c("green", "yellow", "orange", "red"))
)
highchart(type = "map") |>
hc_chart( map= "topology",
spacingBottom= 20) |>
hc_add_series(
mapData = shape_json,
data = dgeo,
joinBy = "name"
) |>
hc_colors(
stops = color_stops(colors = c("green", "yellow", "orange", "red"))
)
data$value
data <- read.csv("BD mapa de riesgo - Sheet1.csv")
data <- data |> dplyr::filter(annoh == "2022",
variable == "Consolidado de riesgo",
circ == "Nacionales") |>
dplyr::select(Municipio, riesgo, codmpio)
data$value <- recode(data$riesgo,
"Sin riesgo" = 0,
"Medio (por alto nivel de la variable)" = 1,
"Alto (por alto nivel de la variable)" = 2,
"Extremo (por alto nivel de la variable)" = 3)
d <- geodato::gd_match(data, map_name)
dgeo <- tj |> left_join(d, by = c(id = "..gd_id", name = "..gd_name"))
dgeo <- dgeo %>% sf::st_set_crs(3857)
shape_transform <- sf::st_transform(dgeo,
"+proj=mill +lat_0=0 +lon_0=0 +x_0=0 +y_0=0 +R_A +datum=WGS84 +units=m +no_defs")
shape_json <- geojsonio::geojson_json(shape_transform)
highchart(type = "map") |>
hc_chart( map= "topology",
spacingBottom= 20) |>
hc_add_series(
mapData = shape_json,
data = dgeo,
joinBy = "name"
) |>
hc_colors(
stops = color_stops(colors = c("green", "yellow", "orange", "red"))
)
data <- read.csv("BD mapa de riesgo - Sheet1.csv")
data <- data |> dplyr::filter(annoh == "2022",
variable == "Consolidado de riesgo",
circ == "Nacionales") |>
dplyr::select(Municipio, value = riesgo, codmpio)
d <- geodato::gd_match(data, map_name)
dgeo <- tj |> left_join(d, by = c(id = "..gd_id", name = "..gd_name"))
dgeo <- dgeo %>% sf::st_set_crs(3857)
shape_transform <- sf::st_transform(dgeo,
"+proj=mill +lat_0=0 +lon_0=0 +x_0=0 +y_0=0 +R_A +datum=WGS84 +units=m +no_defs")
shape_json <- geojsonio::geojson_json(shape_transform)
highchart(type = "map") |>
highchart(type = "map") |>
hc_chart( map= "topology",
spacingBottom= 20) |>
hc_add_series(
mapData = shape_json,
data = dgeo,
joinBy = "name"
) |>
hc_colorAxis(
stops = color_stops(colors = c("green", "yellow", "orange", "red"))
)
data <- read.csv("BD mapa de riesgo - Sheet1.csv")
data <- data |> dplyr::filter(annoh == "2022",
variable == "Consolidado de riesgo",
circ == "Nacionales") |>
dplyr::select(Municipio, riesgo, codmpio)
data$value <- recode(data$riesgo,
"Sin riesgo" = 0,
"Medio (por alto nivel de la variable)" = 1,
"Alto (por alto nivel de la variable)" = 2,
"Extremo (por alto nivel de la variable)" = 3)
d <- geodato::gd_match(data, map_name)
dgeo <- tj |> left_join(d, by = c(id = "..gd_id", name = "..gd_name"))
dgeo <- dgeo %>% sf::st_set_crs(3857)
shape_transform <- sf::st_transform(dgeo,
"+proj=mill +lat_0=0 +lon_0=0 +x_0=0 +y_0=0 +R_A +datum=WGS84 +units=m +no_defs")
shape_json <- geojsonio::geojson_json(shape_transform)
highchart(type = "map") |>
hc_chart( map= "topology",
spacingBottom= 20) |>
hc_add_series(
mapData = shape_json,
data = dgeo,
joinBy = "name"
) |>
hc_colorAxis(
stops = color_stops(colors = c("green", "yellow", "orange", "red"))
)
highchart(type = "map") |>
hc_add_series(
mapData = shape_json,
data = dgeo,
joinBy = "name"
) |>
hc_colorAxis(
stops = color_stops(colors = c("green", "yellow", "orange", "red"))
)
map_name <- "col_municipalities"
tj <- geodato::gd_tj(map_name)
data <- read.csv("BD mapa de riesgo - Sheet1.csv")
data <- data |> dplyr::filter(annoh == "2022",
variable == "Consolidado de riesgo",
circ == "Nacionales") |>
dplyr::select(Municipio, riesgo, codmpio)
data$value <- recode(data$riesgo,
"Sin riesgo" = 0,
"Medio (por alto nivel de la variable)" = 1,
"Alto (por alto nivel de la variable)" = 2,
"Extremo (por alto nivel de la variable)" = 3)
d <- geodato::gd_match(data, map_name)
d$label <- d$riesgo
dgeo <- tj |> left_join(d, by = c(id = "..gd_id", name = "..gd_name"))
dgeo <- dgeo %>% sf::st_set_crs(3857)
shape_transform <- sf::st_transform(dgeo,
"+proj=mill +lat_0=0 +lon_0=0 +x_0=0 +y_0=0 +R_A +datum=WGS84 +units=m +no_defs")
shape_json <- geojsonio::geojson_json(shape_transform)
highchart(type = "map") |>
hc_add_series(
mapData = shape_json,
data = dgeo,
joinBy = "name"
) |>
hc_colorAxis(
stops = color_stops(colors = c("green", "yellow", "orange", "red"))
) |>
hc_tooltip(useHTML = TRUE,
formatter = JS(paste0("function () {return this.point.label;}")))
data <- tibble(
country =
c("PT", "IE", "GB", "IS",
"NO", "SE", "DK", "DE", "NL", "BE", "LU", "ES", "FR", "PL", "CZ", "AT",
"CH", "LI", "SK", "HU", "SI", "IT", "SM", "HR", "BA", "YF", "ME", "AL", "MK",
"FI", "EE", "LV", "LT", "BY", "UA", "MD", "RO", "BG", "GR", "TR", "CY",
"RU"),
tz = c(rep("UTC", 4), rep("UTC + 1",25), rep("UCT + 2",12), "UTC + 3")
)
# auxiliar variable
data <- data |>
mutate(value = cumsum(!duplicated(tz)))
data
# now we'll create the dataClasses
dta_clss <- data |>
mutate(value = cumsum(!duplicated(tz))) |>
group_by(tz) |>
summarise(value = unique(value)) |>
arrange(value) |>
rename(name = tz, from = value) |>
mutate(to = from + 1) |>
list_parse()
dta_clss
data <- read.csv("BD mapa de riesgo - Sheet1.csv")
data <- data |> dplyr::filter(annoh == "2022",
variable == "Consolidado de riesgo",
circ == "Nacionales") |>
dplyr::select(Municipio, riesgo, codmpio)
# data$value <- recode(data$riesgo,
#                      "Sin riesgo" = 0,
#                      "Medio (por alto nivel de la variable)" = 1,
#                      "Alto (por alto nivel de la variable)" = 2,
#                      "Extremo (por alto nivel de la variable)" = 3)
#
data <- data |>
mutate(value = cumsum(!duplicated(riesgo)))
data
View(data)
data$value <- recode(data$riesgo,
"Sin riesgo" = 0,
"Medio (por alto nivel de la variable)" = 1,
"Alto (por alto nivel de la variable)" = 2,
"Extremo (por alto nivel de la variable)" = 3)
d <- geodato::gd_match(data, map_name)
d$label <- d$riesgo
dgeo <- tj |> left_join(d, by = c(id = "..gd_id", name = "..gd_name"))
dgeo <- dgeo %>% sf::st_set_crs(3857)
shape_transform <- sf::st_transform(dgeo,
"+proj=mill +lat_0=0 +lon_0=0 +x_0=0 +y_0=0 +R_A +datum=WGS84 +units=m +no_defs")
dta_clss <- data |>
mutate(value = value) |>
group_by(riesgo) |>
summarise(value = unique(value)) |>
arrange(value) |>
rename(name = riesgo, from = value) |>
mutate(to = from + 1) |>
list_parse()
dta_clss
highchart(type = "map") |>
hc_add_series(
mapData = shape_json,
data = dgeo,
joinBy = "name"
) |>
hc_colorAxis(
stops = color_stops(colors = c("green", "yellow", "orange", "red")),
dataClassColor = "category",
dataClasses = dta_clss
) |>
hc_tooltip(useHTML = TRUE,
formatter = JS(paste0("function () {return this.point.label;}")))
highchart(type = "map") |>
hc_add_series(
mapData = shape_json,
data = dgeo,
joinBy = "name"
) |>
hc_colorAxis(
#stops = color_stops(colors = c("green", "yellow", "orange", "red")),
dataClassColor = "category",
dataClasses = dta_clss
) |>
hc_tooltip(useHTML = TRUE,
formatter = JS(paste0("function () {return this.point.label;}")))
?hc_colorAxis
library(highcharter)
library(geodato)
library(dplyr)
map_name <- "col_municipalities"
tj <- geodato::gd_tj(map_name)
data <- read.csv("BD mapa de riesgo - Sheet1.csv")
data <- data |> dplyr::filter(annoh == "2022",
variable == "Consolidado de riesgo",
circ == "Nacionales") |>
dplyr::select(Municipio, riesgo, codmpio)
data$value <- recode(data$riesgo,
"Sin riesgo" = 0,
"Medio (por alto nivel de la variable)" = 1,
"Alto (por alto nivel de la variable)" = 2,
"Extremo (por alto nivel de la variable)" = 3)
data$color <- recode(data$riesgo,
"Sin riesgo" = "green",
"Medio (por alto nivel de la variable)" = "yellow",
"Alto (por alto nivel de la variable)" = "orange",
"Extremo (por alto nivel de la variable)" = "red")
# data <- data |>
#   mutate(value = cumsum(!duplicated(riesgo)))
d <- geodato::gd_match(data, map_name)
d$label <- d$riesgo
dgeo <- tj |> left_join(d, by = c(id = "..gd_id", name = "..gd_name"))
dgeo <- dgeo %>% sf::st_set_crs(3857)
shape_transform <- sf::st_transform(dgeo,
"+proj=mill +lat_0=0 +lon_0=0 +x_0=0 +y_0=0 +R_A +datum=WGS84 +units=m +no_defs")
shape_json <- geojsonio::geojson_json(shape_transform)
dta_clss <- data |>
mutate(value = value) |>
group_by(riesgo) |>
summarise(value = unique(value)) |>
arrange(value) |>
rename(name = riesgo, from = value) |>
mutate(to = from + 1) |>
list_parse()
highchart(type = "map") |>
hc_add_series(
mapData = shape_json,
data = dgeo,
joinBy = "name"
) |>
hc_colorAxis(
#stops = color_stops(colors = c("green", "yellow", "orange", "red")),
dataClassColor = "category",
dataClasses = dta_clss
) |>
hc_tooltip(useHTML = TRUE,
formatter = JS(paste0("function () {return this.point.label;}")))
dta_clss
map_name <- "col_municipalities"
tj <- geodato::gd_tj(map_name)
data <- read.csv("BD mapa de riesgo - Sheet1.csv")
data <- data |> dplyr::filter(annoh == "2022",
variable == "Consolidado de riesgo",
circ == "Nacionales") |>
dplyr::select(Municipio, riesgo, codmpio)
data$value <- recode(data$riesgo,
"Sin riesgo" = 0,
"Medio (por alto nivel de la variable)" = 1,
"Alto (por alto nivel de la variable)" = 2,
"Extremo (por alto nivel de la variable)" = 3)
data$color <- recode(data$riesgo,
"Sin riesgo" = "green",
"Medio (por alto nivel de la variable)" = "yellow",
"Alto (por alto nivel de la variable)" = "orange",
"Extremo (por alto nivel de la variable)" = "red")
# data <- data |>
#   mutate(value = cumsum(!duplicated(riesgo)))
d <- geodato::gd_match(data, map_name)
d$label <- d$riesgo
dgeo <- tj |> left_join(d, by = c(id = "..gd_id", name = "..gd_name"))
dgeo <- dgeo %>% sf::st_set_crs(3857)
shape_transform <- sf::st_transform(dgeo,
"+proj=mill +lat_0=0 +lon_0=0 +x_0=0 +y_0=0 +R_A +datum=WGS84 +units=m +no_defs")
shape_json <- geojsonio::geojson_json(shape_transform)
data |>
mutate(value = value)
data |>
mutate(value = value) |>
group_by(riesgo) |>
summarise(value = unique(value))
data |>
mutate(value = value) |>
group_by(riesgo) |>
summarise(value = unique(value), color = unique(color)) |>
arrange(value)
data |>
mutate(value = value) |>
group_by(riesgo) |>
summarise(value = unique(value), color = unique(color)) |>
arrange(value) |>
rename(name = riesgo, from = value)
data |>
mutate(value = value) |>
group_by(riesgo) |>
summarise(value = unique(value), color = unique(color)) |>
arrange(value) |>
rename(name = riesgo, from = value) |>
mutate(to = from + 1)
dta_clss <- data |>
mutate(value = value) |>
group_by(riesgo) |>
summarise(value = unique(value), color = unique(color)) |>
arrange(value) |>
rename(name = riesgo, from = value) |>
mutate(to = from + 1) |>
list_parse()
highchart(type = "map") |>
hc_add_series(
mapData = shape_json,
data = dgeo,
joinBy = "name"
) |>
hc_colorAxis(
#stops = color_stops(colors = c("green", "yellow", "orange", "red")),
dataClassColor = "category",
dataClasses = dta_clss
) |>
hc_tooltip(useHTML = TRUE,
formatter = JS(paste0("function () {return this.point.label;}")))
